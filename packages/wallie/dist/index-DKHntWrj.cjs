"use strict";const e=require("./index-C0i2q9jJ.cjs"),P=require("bitcoinjs-lib"),b=require("./BrowserWalletNetworkMismatchError-CDpdIBHK.cjs");var N=(r=>(r[r.ALL=1]="ALL",r[r.NONE=2]="NONE",r[r.SINGLE=3]="SINGLE",r[r.ALL_ANYONECANPAY=129]="ALL_ANYONECANPAY",r[r.NONE_ANYONECANPAY=130]="NONE_ANYONECANPAY",r[r.SINGLE_ANYONECANPAY=131]="SINGLE_ANYONECANPAY",r))(N||{}),l=(r=>(r.P2WPKH="p2wpkh",r.P2TR="p2tr",r))(l||{});async function c(r,n){try{return(await window.LeatherProvider.request(r,n)).result}catch(s){const o=s,{message:t}=o.error;throw o.error.code===4001?new e.BrowserWalletRequestCancelledByUserError(t):new e.OrditSDKError(`Leather error: ${t}`)}}function d(){if(typeof window>"u")throw new e.OrditSDKError("Cannot call this function outside a browser");return typeof window.LeatherProvider<"u"}async function h(r="mainnet"){if(!d())throw new e.BrowserWalletNotInstalledError("Leather not installed");const s=(await c("getAddresses",{network:r})).addresses.filter(t=>t.type===l.P2TR||t.type===l.P2WPKH),o=e.getNetworkByAddress(s[0].address);if(r!=="signet"&&o!==r||r==="signet"&&o!=="testnet")throw new b.BrowserWalletNetworkMismatchError("Leather network mismatch, please switch it manually");return s.map(t=>({publicKey:t.publicKey,address:t.address,format:e.ADDRESS_TYPE_TO_FORMAT[t.type]}))}async function m(r,{network:n="mainnet",paymentType:s}){if(!d())throw new e.BrowserWalletNotInstalledError("Leather not installed");const{signature:o}=await c("signMessage",{message:r,paymentType:s,network:n});return{base64:o,hex:e.Buffer.from(o,"base64").toString("hex")}}async function y(r,{finalize:n=!0,extractTx:s=!0,allowedSighash:o,accountNumber:t,network:E="mainnet",signAtIndexes:w=[]}={}){if(!d())throw new e.BrowserWalletNotInstalledError("Leather not installed");if(s&&!n)throw new e.BrowserWalletExtractTxFromNonFinalizedPsbtError;const f=r.toHex(),A=await c("signPsbt",{hex:f,allowedSighash:o,account:t,network:E,signAtIndex:w,broadcast:!1}),i=P.Psbt.fromHex(A.hex);if(n&&w.forEach(a=>{try{i.finalizeInput(a)}catch(u){throw console.error("Sign psbt error",u),new e.OrditSDKError("Failed to finalize input")}}),s)try{return{base64:null,hex:i.extractTransaction().toHex()}}catch(a){throw a instanceof Error&&a.message==="Not finalized"?new e.BrowserWalletExtractTxFromNonFinalizedPsbtError:new e.OrditSDKError("Failed to extract transaction from PSBT")}return{base64:i.toBase64(),hex:i.toHex()}}exports.LeatherAddressType=l;exports.LeatherSignatureHash=N;exports.getAddresses=h;exports.isInstalled=d;exports.leatherRequest=c;exports.signMessage=m;exports.signPsbt=y;
