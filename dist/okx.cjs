"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("./index-C0i2q9jJ.cjs"),K=require("bitcoinjs-lib"),b=require("./BrowserWalletSigningError-pfMHrxFL.cjs"),W=require("./utils-BHteXc3c.cjs");function l(){if(typeof window>"u")throw new e.OrditSDKError("Cannot call this function outside a browser");return typeof window.okxwallet<"u"}function u(n="mainnet"){if(!l())throw new e.BrowserWalletNotInstalledError("OKX Wallet not installed");let r;switch(n){case"mainnet":r=window.okxwallet.bitcoin;break;case"testnet":r=window.okxwallet.bitcoinTestnet;break;case"signet":r=window.okxwallet.bitcoinSignet;break;default:throw new e.OrditSDKError("Invalid network")}if(!r)throw new e.OrditSDKError("Failed to get OKX Wallet provider");return r}async function m(n="mainnet"){if(!l())throw new e.BrowserWalletNotInstalledError("OKX Wallet not installed");const r=u(n);try{const{address:t,publicKey:s}=await r.connect(),o=e.getAddressFormat(t,n),i=W.fromXOnlyToFullPubkey(s);if(!t||!i||!o)throw new e.OrditSDKError("Failed to get addresses from OKX Wallet");return[{publicKey:i,address:t,format:o}]}catch(t){if(t instanceof e.OrditSDKError)throw t;const s=t;throw s.code===4001?new e.BrowserWalletRequestCancelledByUserError:new e.OrditSDKError(s.message)}}async function y(n,{finalize:r=!0,extractTx:t=!0,network:s,inputsToSign:o}={network:"mainnet",inputsToSign:[]}){if(!l())throw new e.BrowserWalletNotInstalledError("OKX Wallet not installed");if(t&&!r)throw new e.BrowserWalletExtractTxFromNonFinalizedPsbtError;const i=u(s),d=n.toHex();let c="";const f=[];o.forEach(a=>{const{address:w,signingIndexes:E,sigHash:h}=a;E.forEach(x=>{f.push({index:x,address:w,sighashTypes:h?[h]:void 0})})});try{c=await i.signPsbt(d,{autoFinalized:r,toSignInputs:f})}catch(a){const w=a;throw w.code===4001?new e.BrowserWalletRequestCancelledByUserError:new e.OrditSDKError(w.message)}if(!c)throw new b.BrowserWalletSigningError("Failed to sign psbt hex using OKX Wallet");const g=K.Psbt.fromHex(c);if(t)try{return{base64:null,hex:g.extractTransaction().toHex()}}catch(a){throw a instanceof Error&&a.message==="Not finalized"?new e.BrowserWalletExtractTxFromNonFinalizedPsbtError:new e.OrditSDKError("Failed to extract transaction from PSBT")}else return{base64:g.toBase64(),hex:g.toHex()}}async function O(n,r="ecdsa",t="mainnet"){if(!l())throw new e.BrowserWalletNotInstalledError("OKX Wallet not installed");const s=u(t);let o="";try{o=await s.signMessage(n,r)}catch(i){const d=i;throw d.code===4001?new e.BrowserWalletRequestCancelledByUserError:new e.OrditSDKError(d.message)}if(!o)throw new b.BrowserWalletSigningError("Failed to sign message using OKX Wallet");return{base64:o,hex:e.Buffer.from(o,"base64").toString("hex")}}exports.getAddresses=m;exports.isInstalled=l;exports.signMessage=O;exports.signPsbt=y;
